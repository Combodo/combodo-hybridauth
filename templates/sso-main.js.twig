var landing_callback_url = $('#landing_callback_url');
landing_callback_url.find('.ibo-alert--body').html("{{ landing_url_msg | raw }}");

function collectDataProperties(){
	const returnObj = {
		"ssoSP": document.getElementById("selected_sp").value,
		"ssoEnabled": document.getElementById("ssoEnabled").checked,
		"ssoSpId": document.getElementById("ssoSpId").value,
		"ssoUserSync": document.getElementById("ssoUserSync").checked,
		"ssoUserOrg": document.getElementById("ssoUserOrg").value,
		"ssoSpSecret": document.getElementById("ssoSpSecret").value,
	}

	return returnObj;
}

function callController(action){
	$('#SaveButton').disabled=true;

	let data = collectDataProperties();
	//console.log(data);
	url = "{{ sso_url | raw }}&selected_sp=" + data['ssoSP'] + "&operation=" + action;

	$.ajax({
		type: "POST",
		url: url,
		data: { 'SSOConfig' : data }
	})
	.done(function (data) {
		$('#SaveButton').disabled=false;
		if (data.code !== 0) {
			console.log(data);
		}
	})
	.fail(function (data) {
		$('#SaveButton').disabled=false;
		console.log(data);
		return false;
	});
	return true;
};

function testConnexion(){
	$('#TestButton').disabled=true;
	$res = callController('Save');

	if ($res){
		let data = collectDataProperties();
		url = "{{ test_sso_url | raw }}?login_mode=hybridauth-" + data['ssoSP'];
		window.location.href = url;
	}
	$('#TestButton').disabled=false;
}

function setTestButtonState() {
	let data = collectDataProperties();
	let button = $('#TestButton');

	button.prop('title', "{{ 'combodo-hybridauth:TestConnectionToolTip'|dict_s}}");
	if (data["ssoEnabled"] === true) {
		button.disabled=false;
		button.removeClass('ibo-is-hidden');
	} else {
		button.addClass('ibo-is-hidden');
		button.disabled=true;

	}
}

function changeSP(newSP){
	url = "{{ sso_url | raw }}&selected_sp=" + newSP;
	window.location.href = url;
}
